tinymce.PluginManager.add("upload", function(a) {
    a.addCommand("mceUpload", function() {
        a.windowManager.open({
            title: "上传图片",
            width: parseInt(a.getParam("plugin_upload_width", "690"), 10),
            height: parseInt(a.getParam("plugin_upload_height", "400"), 10),
            html: '<iframe src="/upload/grid" id="upload_iframe"></iframe>',
            buttons: [{
                text: "确定",
				subtype: 'primary',
                onclick: function() {
					var upload = window.frames["upload_iframe"].contentDocument.getElementById('fsUploadProgress');
					var selected = upload.getElementsByClassName('selected');
					for(var i=0; i<selected.length;i++) {
						var src = $(selected[i]).attr('o-src');
						src = a.documentBaseURI.toAbsolute(src);
						a.insertContent('<img src="'+src+'">');
					}
					this.parent().parent().close();
                }
            }, {
                text: "Cancel",
                onclick: function() {
                    this.parent().parent().close();
                }
            }],
			onSubmit: function(b) {
				alert();
			}
        })
    }),
    a.addButton("upload", {
		icon: "browse",
        title: "上传图片",
        cmd: "mceUpload"
    })
});